version: "3.6"
services:
# ____________________ vpn-proxy (media/vpn-client for media)
  vpn-proxy:
    container_name: vpn-proxy
    image: jeroenslot/nordvpn-proxy:latest
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun
    dns:
      - 103.86.96.100
      - 103.86.99.100
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ovpn-data:/app/ovpn/config
    environment:
      - USERNAME=zilexa@gmx.com
      - PASSWORD=TVflix!56
      - LOCAL_NETWORK=192.168.88.0/24
      - COUNTRY=NL
      - PROTOCOL=udp
    networks:
      - default
    ports:
      - 8118:8118 #Privoxy PROXY
      - 8989:8989 #Sonarr PVR tvshows
      - 7878:7878 #Radarr PVR movies
      - 9117:9117 #Jackett SEARCHPROVIDER
      - 6789:6789 #NZBget DOWNLOADER
      - 9091:9091 #Transmission DOWNLOADER
      - 51413:51413 #p2p
      - 51413:51413/udp #p2p DHT
    restart: always
# ____________________ Unbound (security/DNS-recursive)
  unbound:
    image: mvance/unbound
    container_name: unbound
    network_mode: bridge
    restart: unless-stopped
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${USERDIR}/docker/unbound/config:/opt/unbound/etc/unbound/
    ports:
      - "54:53/tcp"
# ____________________ PiHole (security/DNS-server)
  pihole:
    image: pihole/pihole:latest
    container_name: pihole
    network_mode: bridge
    restart: unless-stopped
    # Recommended but not required (only for DHCP)
    #   https://github.com/pi-hole/docker-pi-hole#note-on-capabilities
#    cap_add:
#      - NET_ADMIN
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      WEBPASSWORD: #removed
    # Volumes store your data between container upgrades
    volumes:
       - './etc-pihole/:/etc/pihole/'
       - './etc-dnsmasq.d/:/etc/dnsmasq.d/'
    ports:
      - "53:53/tcp"
      - "53:53/udp"
      - "67:67/udp"
      - "80:80/tcp"
      - "443:443/tcp"
    dns:
      - 127.0.0.1
      - 1.1.1.1
# ____________________ Unifi Controller (home/Wifi)
  unifi:
    image: goofball222/unifi
    container_name: unifi
    network_mode: bridge
    restart: unless-stopped
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/docker/unifi/cert:/usr/lib/unifi/cert
      - ${USERDIR}/docker/unifi/data:/usr/lib/unifi/data
      - ${USERDIR}/docker/unifi/logs:/usr/lib/unifi/logs
    ports:
      - 3478:3478/udp
      - 8080:8080
      - 8443:8443
      - 8880:8880
      - 8843:8843
# ____________________ Portainer (server/docker management)
  portainer:
    image: portainer/portainer
    container_name: portainer
    restart: always
    environment:
      - TZ=${TZ}
    command: -H unix:///var/run/docker.sock
    ports:
      - "9000:9000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ${USERDIR}/docker/portainer/data:/data
      - ${USERDIR}/docker/shared:/shared
# ____________________ Organizr (server/homepage)
  organizr:
    container_name: organizr
    image: organizrtools/organizr-v2:php-fpm
    network_mode: bridge
    restart: unless-stopped
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
       - ${USERDIR}/docker/organizr:/config
    ports:
      - "8080:80"
# ____________________ Jellyfin (media/library)
  jellyfin:
    container_name: jellyfin
    image: linuxserver/jellyfin
    network_mode: bridge
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Amsterdam
      - UMASK_SET=022 #optional
    volumes:
      - ${USERDIR}/docker/jellyfin/config:/config
      - ${USERDIR}/Media/TVshows:/data/tvshows
      - ${USERDIR}/Media/Movies:/data/movies
      - ${USERDIR}/Music:/data/music
    ports:
      - 8096:8096
      - 8920:8920 #optional
    devices:
      - /dev/dri:/dev/dri
# ____________________ Transmission (media/download-client)
  transmission:
    image: linuxserver/transmission
    container_name: transmission
    network_mode: service:vpn-proxy
    depends_on:
      - vpn-proxy
    restart: unless-stopped
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Amsterdam
      - TRANSMISSION_WEB_HOME=/combustion-release/
      - USER=admin
      - PASS=TVflix!56
    volumes:
      - ${USERDIR}/docker/transmission/config:/config
      - ${USERDIR}/Downloads/incoming:/downloads
# ____________________ Sonarr (media/PVR-TVshows)
  sonarr:
    container_name: sonarr
    image: linuxserver/sonarr:latest
    network_mode: service:vpn-proxy
    depends_on:
      - vpn-proxy
    restart: unless-stopped
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
      - ${USERDIR}/docker/sonarr/config:/config
      - ${USERDIR}/Downloads/incoming:/downloads
      - ${USERDIR}/Media/TVshows:/tv
#    ports:
#      - 8989:8989
# ____________________ Jackett (media/torrent-proxy for Sonarr&Radarr)
  jackett:
    container_name: jackett
    image: linuxserver/jackett:latest
    network_mode: service:vpn-proxy
    depends_on:
      - vpn-proxy
    restart: unless-stopped
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${USERDIR}/docker/jackett/config:/config
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/Downloads/incoming:/downloads 
#    ports:
#      - 9117:9117
# ____________________ Radarr (media/PVR-Novies)
  radarr:
    container_name: radarr
    image: linuxserver/radarr:latest
    network_mode: service:vpn-proxy
    depends_on:
      - vpn-proxy
    restart: unless-stopped
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
      - ${USERDIR}/docker/radarr:/config
      - ${USERDIR}/Downloads/incoming:/downloads
      - ${USERDIR}/Media/Movies:/movies
#    ports:
#      - 7878:7878
# ____________________ Bazarr (media/subtitle-proxy for Sonarr&Radarr)
  bazarr:
    container_name: bazarr
    image: linuxserver/bazarr
    network_mode: service:vpn-proxy
    depends_on:
      - vpn-proxy
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - UMASK_SET=022 #optional
    volumes:
      - ${USERDIR}/docker/config:/config
      - ${USERDIR}/Media/Movies:/movies
      - ${USERDIR}/Media/TVshows:/tv
    restart: unless-stopped
# ____________________ NZBget (media/download-client)
  nzbget:
    container_name: nzbget
    image: linuxserver/nzbget:latest
    restart: unless-stopped
    network_mode: service:vpn-proxy
    depends_on:
      - vpn-proxy
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${USERDIR}/docker/nzbget/config:/config
      - ${USERDIR}/Downloads/incoming:/downloads
#    ports:
#      - 6789:6789
# ____________________ SyncThing (privatecloud/filesync)
  syncthing:
    image: linuxserver/syncthing
    container_name: syncthing
    network_mode: bridge
    restart: unless-stopped
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - UMASK_SET=022
    volumes:
      - ${USERDIR}/docker/syncthing/config:/config
      - ${USERDIR}/Documents:/documents:rw
      - ${USERDIR}/Pictures:/photos:rw
      - /mnt/pool/backups:/backups:rw
    ports:
      - '8384:8384'
      - '21027:21027/udp'
      - '22000:22000'
# ___________TBA_________ NextCloud (privatecloud/privatecloud)
# ___________TBA_________ Piwigo or OwnPhotos (privatecloud/photo-library)
volumes:
  ovpn-data:
